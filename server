inquire(){
  run=true
  while [ $run = true ]; do
    echo -n "$1 [p/d] "
    read answer
    answer=$(echo $answer | tr '[:upper:'] '[:lower:]')

    case $answer in
      "p" | "production")
        return 1;;
      "d" | "development")
        return 0;;
      *);;
    esac
  done
}

# Check if the server is running
if pgrep "node" > /dev/null; then
  # If it's running, stop it
  pkill "node"
  clear
  echo "The server has been stopped!"
  echo ""
  echo "Start your application by executing this command:"
  echo ". server"
  echo ""
else
  # Otherwise start the server
  clear
  echo "How would you like to start the server?"
  echo ""
  echo "PRODUCTION mode will do the following:"
  echo "1) Keep the server alive even after closing this window"
  echo "2) Won't reload changes; you'll have to restart the server yourself"
  echo ""
  echo "DEVELOPMENT mode will do the following:"
  echo "1) Stop the server once this window is closed"
  echo "2) Automatically reload file changes"
  echo ""

  inquire "PRODUCTION or DEVELOPMENT"
  choice=$?
  clear

  if [[ $choice == 1 ]]; then
    # PRODUCTION
    nohup node server.js &
    clear
    echo "Now running in production mode"
    echo ""
    echo "Stop the application by executing this command:"
    echo ". server"
    echo ""
    rm nohup.out
  else
    # DEVELOPMENT
    clear
    echo "Now running in development mode"
    echo "press Ctrl+C to stop the server"
    echo ""
    nodemon server.js
  fi
fi
